BINARY := converters
CC := gcc


SRCS_DIR := ../src
SRCDIRS := $(shell find $(SRCS_DIR) -mount -name '*.c' -exec dirname {} \; | sort -u)
SRC := $(SRCS_DIR)/converters.c $(SRCS_DIR)/hello/hello.c $(SRCS_DIR)/panic.c $(SRCS_DIR)/string_funcs.c

OBJS_DIR := ../obj
OBJ := $(SRC:$(SRCS_DIR)/%.c=$(OBJS_DIR)/%.o)
DEP_FILES := $(OBJ:.o=.d)

LDLIBS := -lm
LDFLAGS =
INC_FLAGS := $(addprefix -I,$(SRCDIRS))
DEBUG_FLAGS := -g -pedantic -fsanitize=undefined -fsanitize-undefined-trap-on-error -fstack-protector-all
WARN_FLAGS := -std=c17 -Wall -Werror -Wextra
CFLAGS := $(WARN_FLAGS) $(INC_FLAGS) -MMD $(DEBUG_FLAGS)


all: $(BINARY)

$(BINARY): $(OBJ)
	$(CC) $^ -o $@ $(LDLIBS)

$(OBJ):$(OBJS_DIR)/%.o: $(SRCS_DIR)/%.c
	@mkdir -p $(@D)
	$(CC) $(CFLAGS) -c $< -o $@
